{% extends 'core/base.html' %}

{% block title %}Âä†ÁõüÂ∫ó„Éû„ÉÉ„Éó | GreenReceipt{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  .map-page {
    /* Mobile: Full height minus header */
    display: flex;
    flex-direction: column;
    height: calc(100dvh - 140px);
    width: 100%;
    position: relative;
    padding-bottom: 0;
  }

  .map-content-wrapper {
    position: relative;
    flex: 1; 
    width: 100%;
    border-radius: 16px;
    overflow: hidden; 
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
    border: 1px solid #e2e8f0;
  }

  /* 
     Search Container - Top Full Width 
     Replaces the title.
  */
  .search-container {
    width: 100%;
    padding: 0 0 15px 0;
    z-index: 100;
  }
  
  .search-box {
    background: #fff;
    padding: 8px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); /* Lighter shadow since it's cleaner */
    display: flex;
    gap: 8px;
    width: 100%;
    border: 1px solid #e2e8f0;
  }
  
  .search-input {
    flex: 2;
    min-width: 0; /* Allow shrinking */
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 10px 12px;
    font-size: 0.95rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .search-input:focus { border-color: #22c55e; }
  
  .search-select {
    flex: 1;
    min-width: 80px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    padding: 10px 4px;
    font-size: 0.9rem;
    outline: none;
    background: #fff;
  }
  
  .btn-filter {
    background: #22c55e;
    color: #fff;
    border: none;
    border-radius: 8px;
    padding: 0 16px;
    font-weight: 700;
    cursor: pointer;
    white-space: nowrap;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 44px;
    transition: background 0.2s;
  }
  .btn-filter:hover { background: #16a34a; }

  /* Map Element */
  #map {
    width: 100%;
    height: 100%; 
    z-index: 1;
    min-height: 400px; 
  }

  /* Desktop Adjustments */
  @media (min-width: 768px) {
    .map-page {
      height: auto;
      min-height: 600px;
      padding-bottom: 20px;
      display: block; 
    }
    .map-content-wrapper {
        height: 600px; 
    }
  }

  .leaflet-bar { border: none !important; box-shadow: none !important; }
  .leaflet-bar a {
    background-color: #fff;
    border-bottom: 1px solid #ccc;
    color: #444;
    display: block;
    height: 36px;
    width: 36px;
    line-height: 36px;
    border-radius: 8px !important;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15) !important;
  }
  .store-popup .store-name {
    font-weight: 700; color: #0f172a; font-size: 1.1rem;
    border-bottom: 2px solid #22c55e; padding-bottom: 4px; display: inline-block; margin-bottom: 4px;
  }
  .store-popup .info-label { font-weight: 600; color: #64748b; font-size: 0.85rem; }
  
  .leaflet-control-custom {
      margin-top: 10px !important;
      margin-bottom: 0 !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="map-page">
    
    <!-- Title removed, Search Container added here -->
    <div class="search-container">
        <div class="search-box">
            <input type="text" id="keyword-input" class="search-input" placeholder="Â∫óËàóÂêç„ÅßÊ§úÁ¥¢..." list="store-names" autocomplete="off">
            <datalist id="store-names"></datalist>
            
            <select id="category-select" class="search-select">
                <option value="">ÂÖ®Á®ÆÂà•</option>
                <option value="restaurant">È£≤È£üÂ∫ó</option> 
                <option value="retail">Â∞èÂ£≤</option>
                <option value="service">„Çµ„Éº„Éì„Çπ</option>
                <option value="other">„Åù„ÅÆ‰ªñ</option>
            </select>
            <button id="filter-button" class="btn-filter">üîç</button>
        </div>
    </div>
    
    <div class="map-content-wrapper">
        <div id="map"></div>
    </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script id="stores-data" type="application/json">
{{ stores_json|safe }}
</script>
<script src="{% static 'js/store_map.js' %}?v=1.0"></script>
{% endblock %}
